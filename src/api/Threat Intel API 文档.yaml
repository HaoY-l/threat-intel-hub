openapi: 3.0.3
info:
  title: Integrated Security and AI Platform API
  version: 1.0.0
  description: æä¾›äº†Thhreat Intel API æ–‡æ¡£ã€‚
servers:
  - url: /api
    description: åŸºç¡€ API è·¯å¾„

paths:
  # --- AI Chat Paths ---
  /aichat:
    post:
      tags:
        - AI Chat
      summary: å‘èµ· AI å¯¹è¯
      description: å‘æŒ‡å®šçš„ AI æ¨¡å‹å‘é€æ¶ˆæ¯ï¼Œè·å–ä¸“ä¸šçš„ç½‘ç»œå®‰å…¨åˆ†æå›å¤ã€‚é»˜è®¤ä½¿ç”¨ 'doubao' æ¨¡å‹ã€‚
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - message
              properties:
                message:
                  type: string
                  description: ç”¨æˆ·å‘é€çš„å¯¹è¯æ¶ˆæ¯å†…å®¹ã€‚
                  example: æœ€è¿‘æœ‰æ²¡æœ‰æ–°çš„é«˜å± CVE æ¼æ´ï¼Ÿ
                model:
                  type: string
                  description: æŒ‡å®šä½¿ç”¨çš„ AI æ¨¡å‹åç§°ã€‚é»˜è®¤ä¸º 'doubao'ã€‚
                  example: doubao
      responses:
        '200':
          description: AI æ¨¡å‹çš„æˆåŠŸå›å¤ã€‚
          content:
            application/json:
              schema:
                type: object
                properties:
                  reply:
                    type: string
                    description: AI æ¨¡å‹çš„å›å¤å†…å®¹ã€‚
                    example: ä½ å¥½ï¼ä½œä¸ºä¸“ä¸šçš„ç½‘ç»œå®‰å…¨åˆ†æå¸ˆï¼Œæˆ‘å¾ˆé«˜å…´ä¸ºæ‚¨æä¾›ä¿¡æ¯ã€‚æœ€è¿‘...
        '400':
          description: ç¼ºå°‘å‚æ•°æˆ–æ¨¡å‹æœªæ‰¾åˆ°ã€‚
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AIErrorResponse'
              example:
                error: ç¼ºå°‘æ¶ˆæ¯å‚æ•°
        '500':
          description: AI æœåŠ¡è°ƒç”¨å¤±è´¥æˆ–è¿”å›å¼‚å¸¸ã€‚
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AIErrorResponse'
              example:
                error: è¯·æ±‚APIå¤±è´¥: è¯ä¹¦éªŒè¯é”™è¯¯

  /models:
    get:
      tags:
        - Model Management
      summary: è·å–æ‰€æœ‰å¯ç”¨çš„ AI æ¨¡å‹åˆ—è¡¨
      description: æŸ¥è¯¢æ•°æ®åº“ä¸­é…ç½®çš„æ‰€æœ‰ AI æ¨¡å‹ä¿¡æ¯ã€‚
      responses:
        '200':
          description: æˆåŠŸè·å–æ¨¡å‹åˆ—è¡¨ã€‚
          content:
            application/json:
              schema:
                type: object
                properties:
                  models:
                    type: array
                    items:
                      $ref: '#/components/schemas/ModelConfig'
        '500':
          description: æ•°æ®åº“æŸ¥è¯¢å¤±è´¥ã€‚
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AIErrorResponse'
    post:
      tags:
        - Model Management
      summary: åˆ›å»ºæ–°çš„ AI æ¨¡å‹é…ç½®
      description: åœ¨æ•°æ®åº“ä¸­æ·»åŠ ä¸€ä¸ªæ–°çš„ AI æ¨¡å‹é…ç½®ã€‚
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - name
                - api_key
                - model_identifier
                - api_endpoint
              properties:
                name:
                  type: string
                  description: å”¯ä¸€ä¸”æ˜“è¯†åˆ«çš„æ¨¡å‹é…ç½®åç§°ã€‚
                api_key:
                  type: string
                  description: æ¨¡å‹çš„ API å¯†é’¥ã€‚
                model_identifier:
                  type: string
                  description: AI å¹³å°çš„æ¨¡å‹æ ‡è¯†ç¬¦ï¼ˆå¦‚ gpt-4oï¼‰ã€‚
                api_endpoint:
                  type: string
                  format: url
                  description: æ¨¡å‹çš„ API è¯·æ±‚åœ°å€ã€‚
                is_active:
                  type: boolean
                  description: æ˜¯å¦å¯ç”¨è¯¥æ¨¡å‹ã€‚
                  default: true
                config:
                  type: object
                  description: æ¨¡å‹çš„é¢å¤–é…ç½®ä¿¡æ¯ï¼ˆå¦‚ temperature, organizationï¼‰ã€‚
              example:
                name: gpt-4o
                api_key: sk-xxx-yyy
                model_identifier: gpt-4o-2024-05-13
                api_endpoint: https://api.openai.com/v1/chat/completions
      responses:
        '201':
          description: æ¨¡å‹é…ç½®åˆ›å»ºæˆåŠŸã€‚
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: æ¨¡å‹é…ç½®åˆ›å»ºæˆåŠŸ
                  model:
                    $ref: '#/components/schemas/ModelConfig'
        '400':
          description: ç¼ºå°‘å¿…è¦å‚æ•°ã€‚
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AIErrorResponse'
        '409':
          description: æ¨¡å‹åç§°å·²å­˜åœ¨å†²çªã€‚
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AIErrorResponse'
              example:
                error: æ¨¡å‹åç§° 'gpt-4o' å·²å­˜åœ¨ã€‚
        '500':
          description: æ•°æ®åº“æ“ä½œå¤±è´¥ã€‚
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AIErrorResponse'

  /models/{model_id}:
    parameters:
      - name: model_id
        in: path
        required: true
        schema:
          type: integer
        description: æ¨¡å‹é…ç½®çš„å”¯ä¸€ IDã€‚
    put:
      tags:
        - Model Management
      summary: æ›´æ–° AI æ¨¡å‹é…ç½®
      description: æ ¹æ® ID æ›´æ–°æŒ‡å®šçš„ AI æ¨¡å‹é…ç½®ã€‚åªä¼ å…¥éœ€è¦æ›´æ–°çš„å­—æ®µã€‚
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  description: æ¨¡å‹é…ç½®çš„åç§°ã€‚
                api_key:
                  type: string
                  description: æ¨¡å‹çš„ API å¯†é’¥ã€‚
                model_identifier:
                  type: string
                  description: AI å¹³å°çš„æ¨¡å‹æ ‡è¯†ç¬¦ã€‚
                api_endpoint:
                  type: string
                  format: url
                  description: æ¨¡å‹çš„ API è¯·æ±‚åœ°å€ã€‚
                is_active:
                  type: boolean
                  description: æ˜¯å¦å¯ç”¨è¯¥æ¨¡å‹ã€‚
                config:
                  type: object
                  description: æ¨¡å‹çš„é¢å¤–é…ç½®ä¿¡æ¯ã€‚
              example:
                is_active: false
                config:
                  temperature: 0.5
      responses:
        '200':
          description: æ¨¡å‹é…ç½®æ›´æ–°æˆåŠŸã€‚
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: æ¨¡å‹é…ç½®æ›´æ–°æˆåŠŸ
                  model:
                    $ref: '#/components/schemas/ModelConfig'
        '400':
          description: æ²¡æœ‰æä¾›è¦æ›´æ–°çš„å­—æ®µã€‚
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AIErrorResponse'
        '404':
          description: æœªæ‰¾åˆ°æŒ‡å®šçš„æ¨¡å‹é…ç½®ã€‚
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AIErrorResponse'
        '500':
          description: æ•°æ®åº“æ“ä½œå¤±è´¥ã€‚
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AIErrorResponse'
    delete:
      tags:
        - Model Management
      summary: åˆ é™¤ AI æ¨¡å‹é…ç½®
      description: æ ¹æ® ID åˆ é™¤æŒ‡å®šçš„ AI æ¨¡å‹é…ç½®ã€‚
      responses:
        '200':
          description: æ¨¡å‹é…ç½®åˆ é™¤æˆåŠŸã€‚
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: æ¨¡å‹é…ç½®åˆ é™¤æˆåŠŸ
        '404':
          description: æœªæ‰¾åˆ°æŒ‡å®šçš„æ¨¡å‹é…ç½®ã€‚
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AIErrorResponse'
        '500':
          description: æ•°æ®åº“æ“ä½œå¤±è´¥ã€‚
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AIErrorResponse'

  # --- WAF Management Paths ---
  /addwhite:
    post:
      tags:
        - WAF Management
      summary: æ‰¹é‡æ·»åŠ  WAF ç™½åå•è§„åˆ™
      description: |
        è°ƒç”¨é˜¿é‡Œäº‘ WAF API (CreateDefenseRule) æ‰¹é‡åˆ›å»ºç™½åå•ï¼ˆæ”¾è¡Œï¼‰è§„åˆ™ã€‚
        æ¯æ¡è§„åˆ™éƒ½å¿…é¡»æŒ‡å®šåç§°ã€æ ‡ç­¾ã€çŠ¶æ€ã€æ¥æºå’Œè‡³å°‘ä¸€ä¸ªæ¡ä»¶ã€‚
        æ¡ä»¶ (conditions) ä¸­çš„ values å­—æ®µç›®å‰ä»…æ”¯æŒ **IP/CIDR**ã€**åŸŸå** æˆ– **URL è·¯å¾„**ã€‚
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: array
              description: è§„åˆ™æ•°ç»„ï¼Œæ¯é¡¹å¯¹åº”ä¸€æ¡æ–°çš„ç™½åå•è§„åˆ™ã€‚
              items:
                $ref: '#/components/schemas/WafWhitelistRule'
            example:
              - name: 'æ”¾è¡Œè¿ç»´IP'
                tags: '{"tag_key":"è¿ç»´", "tag_value":"IP"}'
                status: 1 # 1 ä¸ºå¼€å¯
                origin: 'custom' # æ¥æºï¼Œå¦‚ custom
                conditions:
                  - field: 'ip'
                    action: 'equal'
                    values: '203.0.113.1/32'
              - name: 'æ”¾è¡Œç‰¹å®šè·¯å¾„'
                tags: '{"tag_key":"åº”ç”¨", "tag_value":"API"}'
                status: 1
                origin: 'custom'
                conditions:
                  - field: 'url'
                    action: 'equal'
                    values: '/api/public/data'
      responses:
        '200':
          description: ç™½åå•è§„åˆ™æ·»åŠ æˆåŠŸã€‚
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  message:
                    type: string
                    example: ç™½åå•æ·»åŠ æˆåŠŸ
        '400':
          description: è¯·æ±‚æ•°æ®æ ¼å¼æˆ–å†…å®¹æ ¡éªŒå¤±è´¥ã€‚
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WafErrorResponse'
              examples:
                missing_field:
                  value:
                    status: error
                    message: ç¼ºå°‘å¿…å¡«å­—æ®µ: name
                invalid_value:
                  value:
                    status: error
                    message: æ— æ•ˆçš„ values: some-random-string
        '500':
          description: WAF API è°ƒç”¨å¤±è´¥æˆ–å†…éƒ¨é”™è¯¯ã€‚
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WafErrorResponse'
              example:
                status: error
                message: ç™½åå•æ·»åŠ å¤±è´¥

  /deletewhite:
    post:
      tags:
        - WAF Management
      summary: æ‰¹é‡åˆ é™¤ WAF ç™½åå•è§„åˆ™
      description: |
        è°ƒç”¨é˜¿é‡Œäº‘ WAF API (DeleteDefenseRule) æ‰¹é‡åˆ é™¤æŒ‡å®šçš„ç™½åå•è§„åˆ™ã€‚
        éœ€è¦ä¼ å…¥ä¸€ä¸ªæˆ–å¤šä¸ªè§„åˆ™çš„ ID å­—ç¬¦ä¸²ã€‚
        
        **æ³¨æ„ï¼š** ä¼ å…¥çš„ `rule_id` å‚æ•°éœ€è¦æ˜¯è§„åˆ™ ID çš„ JSON å­—ç¬¦ä¸²æ•°ç»„ï¼Œä¾‹å¦‚ `"[123456, 789012]"`ã€‚
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - rule_id
              properties:
                rule_id:
                  type: string
                  description: è¦åˆ é™¤çš„ WAF è§„åˆ™ IDï¼Œä»¥ JSON å­—ç¬¦ä¸²å½¢å¼ä¼ é€’ã€‚
                  example: "[123456, 789012]"
      responses:
        '200':
          description: ç™½åå•è§„åˆ™åˆ é™¤æˆåŠŸã€‚
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: integer
                    example: 200
                  msg:
                    type: string
                    example: åˆ é™¤æˆåŠŸ
        '400':
          description: ç¼ºå°‘å¿…å¡«å‚æ•°ã€‚
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: integer
                    example: 400
                  msg:
                    type: string
                    example: ç¼ºå°‘ rule_id å‚æ•°
        '500':
          description: WAF API è°ƒç”¨å¤±è´¥æˆ–æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ã€‚
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: integer
                    example: 500
                  msg:
                    type: string
                    example: å†…éƒ¨é”™è¯¯: (400) The specified RuleId is invalid.

  /descblackrule:
    get:
      tags:
        - WAF Management
      summary: æŸ¥è¯¢ WAF é»‘åå•è§„åˆ™è¯¦æƒ…å¹¶æå–IPåˆ—è¡¨
      description: |
        è°ƒç”¨é˜¿é‡Œäº‘ WAF API (DescribeDefenseRule) æŸ¥è¯¢æŒ‡å®š `BLACKLIST_TEMPLATE_ID` ä¸‹ï¼Œ
        ç”± `BLACKLIST_RULES_ID` ç¯å¢ƒå˜é‡æŒ‡å®šçš„é»‘åå•è§„åˆ™è¯¦æƒ…ã€‚
        
        æ¥å£å°†å°è¯•è§£æè¿”å›çš„ `Config` å­—æ®µï¼Œæå–å‡º `remoteAddr` æ•°ç»„ï¼ˆå³é»‘åå• IP åˆ—è¡¨ï¼‰è¿”å›ã€‚
        
        **æ³¨æ„ï¼š** æ­¤æ¥å£çš„ `rule_id` æ˜¯é€šè¿‡æœåŠ¡å™¨ç«¯ç¯å¢ƒå˜é‡è·å–çš„ï¼Œè€Œéé€šè¿‡æŸ¥è¯¢å‚æ•°ä¼ å…¥ã€‚
      responses:
        '200':
          description: æˆåŠŸè·å–è§„åˆ™è¯¦æƒ…åŠ IP åˆ—è¡¨ã€‚
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  message:
                    type: array
                    items:
                      $ref: '#/components/schemas/BlacklistRuleDetail'
              example:
                status: success
                message:
                  - template_id: 12345
                    rule_id: 987654
                    rule_name: TestBlacklistRule
                    ip_list:
                      - 203.0.113.1
                      - 192.0.2.2/32
        '500':
          description: WAF API è°ƒç”¨å¤±è´¥æˆ–è§£æè¿”å›æ•°æ®å¤±è´¥ã€‚
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: error
                  message:
                    type: string
                    description: å…·ä½“çš„é”™è¯¯ä¿¡æ¯ã€‚
                    example: No Config field found.

  /listwhite:
    get:
      tags:
        - WAF Management
      summary: è·å–æŒ‡å®šæ¨¡æ¿ä¸‹çš„ WAF ç™½åå•è§„åˆ™åˆ—è¡¨
      description: |
        è°ƒç”¨é˜¿é‡Œäº‘ WAF API (DescribeDefenseRules) è·å–æ‰€æœ‰ç™½åå•è§„åˆ™ï¼Œç„¶åé€šè¿‡æœåŠ¡å™¨ç«¯é€»è¾‘
        æ ¹æ®ç¯å¢ƒå˜é‡ `WHITELIST_TEMPLATE_ID` ç­›é€‰å‡ºè¯¥æ¨¡æ¿ä¸‹çš„æ‰€æœ‰è§„åˆ™ã€‚
        
        è¿”å›ç»“æœåŒ…å«è§„åˆ™çš„ IDã€åç§°å’Œæ‰€å±æ¨¡æ¿ IDã€‚
      responses:
        '200':
          description: æˆåŠŸè¿”å›ç™½åå•è§„åˆ™åˆ—è¡¨ã€‚
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  message:
                    type: array
                    items:
                      $ref: '#/components/schemas/WafRuleSummary'
              example:
                status: success
                message:
                  - rule_template: 123456
                    rule_id: 1001
                    rule_name: Maintenance IP Whitelist
                  - rule_template: 123456
                    rule_id: 1002
                    rule_name: API Path Exemption
        '500':
          description: WAF API è°ƒç”¨å¤±è´¥æˆ–å‘ç”Ÿå†…éƒ¨é”™è¯¯ã€‚
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: error
                  message:
                    type: string
                    description: å…·ä½“çš„é”™è¯¯ä¿¡æ¯ã€‚
                    example: The specified RegionId is invalid.

  /modifyblackrule:
    post:
      tags:
        - WAF Management
      summary: æ·»åŠ  IP åˆ° WAF ç°æœ‰é»‘åå•è§„åˆ™
      description: |
        è¿™æ˜¯ä¸€ä¸ªå¤åˆæ“ä½œï¼š
        1. **å†…éƒ¨è°ƒç”¨:** è‡ªåŠ¨è°ƒç”¨ `/api/descblackrule` æ¥å£ï¼ˆç¡¬ç¼–ç ä¸º `http://localhost:8891/api/descblackrule`ï¼‰è·å–å½“å‰é»‘åå•è§„åˆ™çš„ IP åˆ—è¡¨å’Œè§„åˆ™ IDã€‚
        2. **IP æ£€æŸ¥:** å°†ç”¨æˆ·ä¼ å…¥çš„ `black_ip` æ·»åŠ åˆ°ç°æœ‰ IP åˆ—è¡¨ä¸­ï¼ˆå¦‚æœè¯¥ IP å°šæœªå­˜åœ¨ï¼‰ã€‚
        3. **å¤–éƒ¨è°ƒç”¨:** è°ƒç”¨é˜¿é‡Œäº‘ WAF API (ModifyDefenseRule) æ›´æ–°æŒ‡å®šæ¨¡æ¿å’Œè§„åˆ™ ID ä¸‹çš„é»‘åå•é…ç½®ã€‚
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - black_ip
              properties:
                black_ip:
                  type: string
                  description: è¦æ·»åŠ åˆ°é»‘åå•çš„ IP åœ°å€æˆ– CIDRã€‚
                  example: 1.1.1.1/32
            examples:
              add_single_ip:
                value:
                  black_ip: 203.0.113.5
      responses:
        '200':
          description: é»‘åå•è§„åˆ™æ›´æ–°æˆåŠŸã€‚
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  message:
                    type: string
                    example: é»‘åå•è§„åˆ™å·²æ›´æ–°
        '400':
          description: è¯·æ±‚å‚æ•°æ— æ•ˆæˆ–ç¼ºå¤±ã€‚
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: error
                  message:
                    type: string
                    example: æ— æ•ˆæˆ–ç¼ºå¤±çš„ IP åœ°å€
        '500':
          description: å†…éƒ¨é”™è¯¯ï¼Œå¯èƒ½åŸå› åŒ…æ‹¬ï¼šå†…éƒ¨æ¥å£è°ƒç”¨å¤±è´¥ã€WAF APIè°ƒç”¨å¤±è´¥ã€æˆ–è§„åˆ™ä¿¡æ¯ç¼ºå¤±ã€‚
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: error
                  message:
                    type: string
                    description: å…·ä½“çš„é”™è¯¯ä¿¡æ¯ã€‚
                    example: Failed to fetch data from descblackrule

  # --- WAF Logs/Data Paths ---
  /alert:
    get:
      tags:
        - WAF Alert
      summary: è§¦å‘ WAF æ¯æ—¥æ”»å‡»æ‹¦æˆªæŠ¥å‘Šå‘é€
      description: |
        è°ƒç”¨é˜¿é‡Œäº‘æ—¥å¿—æœåŠ¡ï¼ˆSLSï¼‰ç»Ÿè®¡ WAF å‰ä¸€å¤©çš„æ”»å‡»æ‹¦æˆªæ—¥å¿—ï¼ˆåŒ…æ‹¬ ACL/CC/Antiscan å°ç¦ï¼‰ï¼Œ
        è®¡ç®—æ¯ä¸ªæ”»å‡» IP çš„è¯·æ±‚æ€»æ¬¡æ•°å’Œæ‹¦æˆªå æ¯”ï¼Œå¹¶å°†æŠ¥å‘Šæ ¼å¼åŒ–åé€šè¿‡é’‰é’‰æœºå™¨äººå‘é€ã€‚
        
        **æ³¨æ„:** 1. æ­¤æ¥å£çš„æˆåŠŸå“åº”ä»…è¡¨ç¤ºè§¦å‘å’Œæ‰§è¡Œé€»è¾‘æˆåŠŸï¼Œä¸ä¿è¯é’‰é’‰æ¶ˆæ¯ä¸€å®šé€è¾¾ï¼ˆä¾èµ–äºé…ç½®å’Œç½‘ç»œï¼‰ã€‚
        2. ç»Ÿè®¡æ—¶é—´èŒƒå›´æ˜¯**å‰ä¸€å¤©**çš„ 00:00:00 åˆ° 23:59:59ã€‚
      responses:
        '200':
          description: æ—¥å¸¸æŠ¥å‘ŠæˆåŠŸè§¦å‘å¹¶å‘é€åˆ°é’‰é’‰ã€‚
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  message:
                    type: string
                    example: Daily report sent successfully.
        '500':
          description: æŠ¥å‘Šç”Ÿæˆæˆ–å‘é€è¿‡ç¨‹ä¸­å‘ç”Ÿå†…éƒ¨é”™è¯¯ï¼ˆå¦‚ SLS/é’‰é’‰ API è°ƒç”¨å¤±è´¥ï¼‰ã€‚
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: error
                  message:
                    type: string
                    description: å…·ä½“çš„é”™è¯¯ä¿¡æ¯ã€‚
                    example: Error while fetching logs from SLS.
  
  /report:
    get:
      tags:
        - WAF Report
      summary: è·å– WAF æ¯æ—¥æ”»å‡»æ‹¦æˆªç»Ÿè®¡æŠ¥å‘Šï¼ˆå†…å®¹ï¼‰
      description: |
        è°ƒç”¨é˜¿é‡Œäº‘æ—¥å¿—æœåŠ¡ï¼ˆSLSï¼‰ç»Ÿè®¡ WAF **å‰ä¸€å¤©**çš„æ”»å‡»æ‹¦æˆªæ—¥å¿—ï¼ˆåŒ…æ‹¬ ACL/CC/Antiscan å°ç¦ï¼‰ï¼Œ
        è®¡ç®—æ¯ä¸ªæ”»å‡» IP çš„è¯·æ±‚æ€»æ¬¡æ•°å’Œæ‹¦æˆªå æ¯”ï¼Œå¹¶å°†æ ¼å¼åŒ–åçš„æŠ¥å‘Šå†…å®¹ï¼ˆMarkdown æ ¼å¼ï¼‰ç›´æ¥åœ¨ JSON å“åº”ä¸­è¿”å›ã€‚
        
        **ç»Ÿè®¡æ—¶é—´èŒƒå›´**æ˜¯å‰ä¸€å¤©çš„ 00:00:00 åˆ° 23:59:59ã€‚
      responses:
        '200':
          description: æˆåŠŸè¿”å›ç”Ÿæˆçš„æ”»å‡»æŠ¥å‘Šå†…å®¹ã€‚
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  message:
                    type: string
                    description: æ ¼å¼åŒ–åçš„ Markdown æŠ¥å‘Šå†…å®¹ã€‚
                    example: |
                      ## ğŸ›¡ï¸ WAFæ”»å‡»æƒ…å†µç»Ÿè®¡ğŸš¨ (2025-11-25)
                      
                      **æ€»æ”»å‡»IPæ•°**: 2
                      
                      - ğŸ”¹ **IP**: 203.0.113.1, **æ‹¦æˆªæ¬¡æ•°**: 500, **æ‹¦æˆªå æ¯”**: 90.1%
                      - ğŸ”¹ **IP**: 198.51.100.2, **æ‹¦æˆªæ¬¡æ•°**: 100, **æ‹¦æˆªå æ¯”**: 65.5%
                      
                      ---
                      
                      > ğŸ“Š *ç»Ÿè®¡æ—¶é—´: 2025-11-26 å«å«é¡¹ç›®*
        '500':
          description: æŠ¥å‘Šç”Ÿæˆè¿‡ç¨‹ä¸­å‘ç”Ÿå†…éƒ¨é”™è¯¯ï¼ˆå¦‚ SLS API è°ƒç”¨å¤±è´¥ï¼‰ã€‚
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: error
                  message:
                    type: string
                    description: å…·ä½“çš„é”™è¯¯ä¿¡æ¯ã€‚
                    example: è·å–å°ç¦æ—¥å¿—æ—¶å‡ºé”™: OSS client error.

  /blocked_ips:
    get:
      tags:
        - WAF Logs/Data
      summary: æŸ¥è¯¢ WAF å°ç¦ IP ç»Ÿè®¡æ•°æ®
      description: |
        ä»æ•°æ®åº“ `blocked_ips` è¡¨ä¸­æŸ¥è¯¢è¢« WAF å°ç¦çš„ IP è¯¦ç»†ç»Ÿè®¡æ•°æ®ã€‚
        æ”¯æŒæŒ‰æ—¶é—´èŒƒå›´ç­›é€‰æ•°æ®ã€‚å¦‚æœæœªæä¾›æ—¶é—´å‚æ•°ï¼Œåˆ™é»˜è®¤è¿”å›ä»å½“å¤©é›¶ç‚¹åˆ°å½“å‰æ—¶é—´çš„æ•°æ®ã€‚
      parameters:
        - name: from
          in: query
          required: false
          schema:
            type: string
            format: date-time
            example: 2024-06-01 00:00:00
          description: èµ·å§‹æ—¶é—´ (YYYY-MM-DD HH:MM:SS æˆ– YYYY-MM-DD HH:MM)ã€‚
        - name: to
          in: query
          required: false
          schema:
            type: string
            format: date-time
            example: 2024-06-01 23:59:59
          description: ç»“æŸæ—¶é—´ (YYYY-MM-DD HH:MM:SS æˆ– YYYY-MM-DD HH:MM)ã€‚
      responses:
        '200':
          description: æˆåŠŸè¿”å›å°ç¦ IP åˆ—è¡¨ã€‚
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/BlockedIpData'
        '500':
          description: æ•°æ®åº“æŸ¥è¯¢å¤±è´¥æˆ–æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ã€‚
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InternalErrorResponse'

  /ip_request_frequency:
    get:
      tags:
        - WAF Logs/Data
      summary: æŸ¥è¯¢é«˜é¢‘è¯·æ±‚ IP æ•°æ®
      description: |
        ä»æ•°æ®åº“ `ip_request_frequency` è¡¨ä¸­æŸ¥è¯¢è¯·æ±‚æ•°è¶…è¿‡é…ç½®é˜ˆå€¼ (`highfreq_ip_count`) çš„ IP æ•°æ®ã€‚
        æ”¯æŒæŒ‰æ—¶é—´èŒƒå›´ç­›é€‰æ•°æ®ã€‚å¦‚æœæœªæä¾›æ—¶é—´å‚æ•°ï¼Œåˆ™é»˜è®¤è¿”å›ä»å½“å¤©é›¶ç‚¹åˆ°å½“å‰æ—¶é—´çš„æ•°æ®ã€‚
      parameters:
        - name: from
          in: query
          required: false
          schema:
            type: string
            format: date-time
            example: 2024-06-01 00:00:00
          description: èµ·å§‹æ—¶é—´ (YYYY-MM-DD HH:MM:SS æˆ– YYYY-MM-DD HH:MM)ã€‚
        - name: to
          in: query
          required: false
          schema:
            type: string
            format: date-time
            example: 2024-06-01 23:59:59
          description: ç»“æŸæ—¶é—´ (YYYY-MM-DD HH:MM:SS æˆ– YYYY-MM-DD HH:MM)ã€‚
      responses:
        '200':
          description: æˆåŠŸè¿”å›é«˜é¢‘è¯·æ±‚ IP åˆ—è¡¨ã€‚
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/RequestFrequencyData'
        '500':
          description: æ•°æ®åº“æŸ¥è¯¢å¤±è´¥æˆ–æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ã€‚
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InternalErrorResponse'

  /protected_ip:
    get:
      tags:
        - WAF Logs/Data
      summary: æŸ¥è¯¢ä»Šå¤©çš„ WAF è‡ªåŠ¨å°ç¦è®°å½•
      description: ä»æ•°æ®åº“ `protected_ip` è¡¨ä¸­æŸ¥è¯¢å¹¶è¿”å›ä»Šå¤©ï¼ˆä» 00:00:00 åˆ°å½“å‰æ—¶é—´ï¼‰çš„æ‰€æœ‰è‡ªåŠ¨å°ç¦è®°å½•ã€‚
      responses:
        '200':
          description: æˆåŠŸè¿”å›ä»Šå¤©çš„è‡ªåŠ¨å°ç¦è®°å½•åˆ—è¡¨ã€‚
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ProtectedIpRecord'
        '500':
          description: æ•°æ®åº“æŸ¥è¯¢å¤±è´¥æˆ–æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ã€‚
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: æ•°æ®åº“æŸ¥è¯¢å¤±è´¥
                  details:
                    type: string
                    example: (2003, "Can't connect to MySQL server...")

  # --- User Management Paths ---
  /auth/users:
    get:
      tags:
        - User Management
      summary: æŸ¥è¯¢æ‰€æœ‰ç”¨æˆ·åˆ—è¡¨
      description: |
        è·å–æ•°æ®åº“ä¸­æ‰€æœ‰ç”¨æˆ·çš„åŸºæœ¬ä¿¡æ¯ï¼ˆID, ç”¨æˆ·å, è§’è‰², åˆ›å»ºæ—¶é—´ï¼‰ã€‚
        **éœ€è¦ç™»å½•ä¸”å…·æœ‰ `user:list` æƒé™ã€‚**
      security:
        - BearerAuth: []
      responses:
        '200':
          description: æˆåŠŸè¿”å›ç”¨æˆ·åˆ—è¡¨ã€‚
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  count:
                    type: integer
                    description: è¿”å›çš„ç”¨æˆ·æ•°é‡ã€‚
                    example: 2
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/UserDetail'
        '401':
          description: æœªæˆæƒæˆ– Token æ— æ•ˆã€‚
        '403':
          description: æƒé™ä¸è¶³ (`user:list` æƒé™ç¼ºå¤±)ã€‚
        '500':
          description: æ•°æ®åº“æŸ¥è¯¢å¤±è´¥ã€‚
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserErrorResponse'
    post:
      tags:
        - User Management
      summary: æ–°å¢ç”¨æˆ·
      description: |
        åˆ›å»ºä¸€ä¸ªæ–°ç”¨æˆ·ã€‚ç”¨æˆ·åé•¿åº¦éœ€åœ¨3-20ä½ï¼Œå¯†ç è‡³å°‘6ä½ï¼Œè§’è‰²ä¸º 'user' æˆ– 'admin'ã€‚
        **éœ€è¦ç™»å½•ä¸”å…·æœ‰ `user:add` æƒé™ã€‚**
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - username
                - password
              properties:
                username:
                  type: string
                  description: ç”¨æˆ·å (3-20ä½)ã€‚
                  example: new_security_analyst
                password:
                  type: string
                  description: å¯†ç  (è‡³å°‘6ä½)ã€‚
                  format: password
                  example: P@sswOrd123
                role:
                  type: string
                  enum: [user, admin]
                  default: user
                  description: ç”¨æˆ·çš„è§’è‰²ã€‚
                  example: user
      responses:
        '201':
          description: æ–°å¢ç”¨æˆ·æˆåŠŸã€‚
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: æ–°å¢ç”¨æˆ·æˆåŠŸ
                  data:
                    type: object
                    properties:
                      username:
                        type: string
                      role:
                        type: string
        '400':
          description: å‚æ•°æ ¡éªŒå¤±è´¥æˆ–ç”¨æˆ·åå·²å­˜åœ¨ã€‚
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserErrorResponse'
              examples:
                invalid_length:
                  value:
                    success: false
                    message: å¯†ç é•¿åº¦è‡³å°‘6ä½
                username_exists:
                  value:
                    success: false
                    message: ç”¨æˆ·åå·²å­˜åœ¨
        '401':
          description: æœªæˆæƒæˆ– Token æ— æ•ˆã€‚
        '403':
          description: æƒé™ä¸è¶³ (`user:add` æƒé™ç¼ºå¤±)ã€‚
        '500':
          description: æ•°æ®åº“æ“ä½œå¤±è´¥ã€‚
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserErrorResponse'

  /auth/users/{username}:
    delete:
      tags:
        - User Management
      summary: åˆ é™¤æŒ‡å®šç”¨æˆ·
      description: |
        æ ¹æ®ç”¨æˆ·ååˆ é™¤ç”¨æˆ·ã€‚**ä¸èƒ½åˆ é™¤å½“å‰ç™»å½•ç”¨æˆ·ã€‚**
        **éœ€è¦ç™»å½•ä¸”å…·æœ‰ `user:delete` æƒé™ã€‚**
      security:
        - BearerAuth: []
      parameters:
        - name: username
          in: path
          required: true
          schema:
            type: string
          description: è¦åˆ é™¤çš„ç”¨æˆ·åã€‚
          example: old_user
      responses:
        '200':
          description: ç”¨æˆ·åˆ é™¤æˆåŠŸã€‚
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: ç”¨æˆ·ã€Œold_userã€åˆ é™¤æˆåŠŸ
        '400':
          description: å°è¯•åˆ é™¤å½“å‰ç™»å½•ç”¨æˆ·ã€‚
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserErrorResponse'
              example:
                success: false
                message: ä¸èƒ½åˆ é™¤å½“å‰ç™»å½•ç”¨æˆ·
        '401':
          description: æœªæˆæƒæˆ– Token æ— æ•ˆã€‚
        '403':
          description: æƒé™ä¸è¶³ (`user:delete` æƒé™ç¼ºå¤±)ã€‚
        '404':
          description: ç”¨æˆ·ä¸å­˜åœ¨ã€‚
        '500':
          description: æ•°æ®åº“æ“ä½œå¤±è´¥ã€‚

  /auth/users/{username}/reset_password:
    put:
      tags:
        - User Management
      summary: é‡ç½®ç”¨æˆ·å¯†ç 
      description: |
        ä¸ºæŒ‡å®šç”¨æˆ·è®¾ç½®æ–°å¯†ç ã€‚
        **éœ€è¦ç™»å½•ä¸”å…·æœ‰ `user:add` æƒé™ã€‚**
      security:
        - BearerAuth: []
      parameters:
        - name: username
          in: path
          required: true
          schema:
            type: string
          description: è¦é‡ç½®å¯†ç çš„ç”¨æˆ·åã€‚
          example: test_user
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - password
              properties:
                password:
                  type: string
                  description: æ–°å¯†ç  (è‡³å°‘6ä½)ã€‚
                  format: password
                  example: NewSecureP@ss
      responses:
        '200':
          description: å¯†ç é‡ç½®æˆåŠŸã€‚
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: ç”¨æˆ·ã€Œtest_userã€çš„å¯†ç å·²é‡ç½®æˆåŠŸ
        '400':
          description: å¯†ç ä¸ç¬¦åˆé•¿åº¦è¦æ±‚ã€‚
        '401':
          description: æœªæˆæƒæˆ– Token æ— æ•ˆã€‚
        '403':
          description: æƒé™ä¸è¶³ (`user:add` æƒé™ç¼ºå¤±)ã€‚
        '404':
          description: ç”¨æˆ·ä¸å­˜åœ¨ã€‚
        '500':
          description: æ•°æ®åº“æ“ä½œå¤±è´¥ã€‚

  # --- Authentication Paths ---
  /auth/login:
    post:
      tags:
        - Authentication
      summary: ç”¨æˆ·ç™»å½•
      description: |
        ç”¨æˆ·é€šè¿‡ç”¨æˆ·åå’Œå¯†ç è¿›è¡Œèº«ä»½éªŒè¯ã€‚
        æˆåŠŸåï¼ŒæœåŠ¡å™¨å°†è®¾ç½®æŒä¹…åŒ– Sessionï¼ˆCookieï¼‰ï¼Œç”¨äºåç»­è¯·æ±‚çš„è®¤è¯ã€‚
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
            example:
              username: admin
              password: P@ssword123
          application/x-www-form-urlencoded:
            schema:
              $ref: '#/components/schemas/LoginRequest'
      responses:
        '200':
          description: ç™»å½•æˆåŠŸï¼ŒSession å·²è®¾ç½®ã€‚
          headers:
            Set-Cookie:
              schema:
                type: string
                example: session=...; Path=/; Expires=Wed, 26 Nov 2025 07:00:00 GMT; HttpOnly
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  data:
                    type: object
                    properties:
                      username:
                        type: string
                        example: admin
                      role:
                        type: string
                        example: admin
                  message:
                    type: string
                    example: ç™»å½•æˆåŠŸ
        '400':
          description: ç¼ºå¤±ç”¨æˆ·åæˆ–å¯†ç ï¼Œæˆ–é•¿åº¦æ ¡éªŒå¤±è´¥ã€‚
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthErrorResponse'
              example:
                status: error
                message: ç”¨æˆ·åå’Œå¯†ç ä¸èƒ½ä¸ºç©º
        '401':
          description: ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯ã€‚
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthErrorResponse'
              example:
                status: error
                message: ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯
        '500':
          description: æ•°æ®åº“è¿æ¥æˆ–æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ã€‚

  /auth/logout:
    post:
      tags:
        - Authentication
      summary: ç”¨æˆ·æ³¨é”€
      description: |
        æ¸…é™¤å½“å‰ç”¨æˆ·çš„ Sessionï¼Œä½¿å…¶é€€å‡ºç™»å½•çŠ¶æ€ã€‚
      responses:
        '200':
          description: æ³¨é”€æˆåŠŸï¼ŒSession å·²æ¸…é™¤ã€‚
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  message:
                    type: string
                    example: å·²æˆåŠŸæ³¨é”€ï¼Œå¦‚éœ€ç»§ç»­æ“ä½œè¯·é‡æ–°ç™»å½•
        '500':
          description: æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ã€‚

  /auth/current-user:
    get:
      tags:
        - Authentication
      summary: è·å–å½“å‰ç™»å½•ç”¨æˆ·ä¿¡æ¯
      description: |
        æ£€æŸ¥å¹¶è¿”å›å½“å‰è¯·æ±‚çš„ç™»å½•çŠ¶æ€å’Œç”¨æˆ·ä¿¡æ¯ï¼ˆä»…ç”¨äºè°ƒè¯•å’ŒçŠ¶æ€æ£€æŸ¥ï¼‰ã€‚
      responses:
        '200':
          description: å·²ç™»å½•ï¼Œè¿”å›ç”¨æˆ·ä¿¡æ¯ã€‚
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  data:
                    type: object
                    properties:
                      id:
                        type: integer
                        example: 1
                      username:
                        type: string
                        example: admin
                      role:
                        type: string
                        example: admin
        '401':
          description: æœªç™»å½•æˆ–ç™»å½•çŠ¶æ€å·²å¤±æ•ˆã€‚
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthErrorResponse'
              example:
                status: error
                message: æœªç™»å½•æˆ–ç™»å½•çŠ¶æ€å·²å¤±æ•ˆ

  # --- Permission Management Paths ---
  /permission/all:
    get:
      tags:
        - Permission Management
      summary: æŸ¥è¯¢ç³»ç»Ÿä¸­çš„æ‰€æœ‰æƒé™
      description: |
        è·å–ç³»ç»Ÿä¸­å®šä¹‰çš„æ‰€æœ‰æƒé™åˆ—è¡¨ï¼Œé€šå¸¸ç”¨äºæƒé™é…ç½®ç•Œé¢ã€‚
        **éœ€è¦ç™»å½•ä¸”å…·æœ‰ `permission:manage` æƒé™ã€‚**
      security:
        - BearerAuth: []
      responses:
        '200':
          description: æˆåŠŸè¿”å›æ‰€æœ‰æƒé™åˆ—è¡¨ã€‚
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Permission'
        '401':
          description: æœªç™»å½•æˆ– Token æ— æ•ˆã€‚
        '403':
          description: æƒé™ä¸è¶³ (`permission:manage` æƒé™ç¼ºå¤±)ã€‚
        '500':
          description: æŸ¥è¯¢å¤±è´¥ã€‚
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PermissionErrorResponse'

  /permission/roles:
    get:
      tags:
        - Permission Management
      summary: æŸ¥è¯¢ç³»ç»Ÿä¸­æ‰€æœ‰è§’è‰²åˆ—è¡¨
      description: |
        è·å–ç³»ç»Ÿä¸­å®šä¹‰çš„æ‰€æœ‰è§’è‰²åç§°åˆ—è¡¨ï¼ˆå¦‚ ['admin', 'user']ï¼‰ã€‚
        **éœ€è¦ç™»å½•ä¸”å…·æœ‰ `permission:manage` æƒé™ã€‚**
      security:
        - BearerAuth: []
      responses:
        '200':
          description: æˆåŠŸè¿”å›è§’è‰²åç§°åˆ—è¡¨ã€‚
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: array
                    items:
                      type: string
                      example: admin
        '401':
          description: æœªç™»å½•æˆ– Token æ— æ•ˆã€‚
        '403':
          description: æƒé™ä¸è¶³ (`permission:manage` æƒé™ç¼ºå¤±)ã€‚
        '500':
          description: æŸ¥è¯¢å¤±è´¥ã€‚
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PermissionErrorResponse'

  /permission/role/{role}/permissions:
    get:
      tags:
        - Permission Management
      summary: æŸ¥è¯¢æŒ‡å®šè§’è‰²æ‹¥æœ‰çš„æƒé™åˆ—è¡¨
      description: |
        æŸ¥è¯¢æŒ‡å®šè§’è‰²å½“å‰é…ç½®çš„æƒé™ï¼Œå¹¶è¿”å›æ‰€æœ‰æƒé™åˆ—è¡¨ï¼ŒåŒæ—¶æ ‡è®°è¯¥è§’è‰²çš„é€‰ä¸­çŠ¶æ€ (`is_selected`)ã€‚
        **éœ€è¦ç™»å½•ã€‚** (è¯¥æ¥å£æœªè¦æ±‚ `permission:manage` æƒé™)
      security:
        - BearerAuth: []
      parameters:
        - name: role
          in: path
          required: true
          schema:
            type: string
            enum: [admin, user]
          description: è¦æŸ¥è¯¢çš„è§’è‰²åç§°ã€‚
          example: user
      responses:
        '200':
          description: æˆåŠŸè¿”å›æ ‡è®°äº†é€‰ä¸­çŠ¶æ€çš„æƒé™åˆ—è¡¨ã€‚
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: array
                    items:
                      allOf:
                        - $ref: '#/components/schemas/Permission'
                        - type: object
                          properties:
                            is_selected:
                              type: boolean
                              description: å½“å‰è§’è‰²æ˜¯å¦æ‹¥æœ‰è¯¥æƒé™ã€‚
                              example: true
        '401':
          description: æœªç™»å½•æˆ– Token æ— æ•ˆã€‚
        '500':
          description: æŸ¥è¯¢å¤±è´¥ã€‚
    put:
      tags:
        - Permission Management
      summary: æ›´æ–°æŒ‡å®šè§’è‰²çš„æƒé™é…ç½®
      description: |
        æ ¹æ®æä¾›çš„æƒé™ ID åˆ—è¡¨ï¼Œæ‰¹é‡æ›´æ–°æŒ‡å®šè§’è‰²çš„æƒé™ã€‚
        **éœ€è¦ç™»å½•ä¸”å…·æœ‰ `permission:manage` æƒé™ã€‚**
      security:
        - BearerAuth: []
      parameters:
        - name: role
          in: path
          required: true
          schema:
            type: string
            enum: [admin, user]
          description: è¦æ›´æ–°çš„è§’è‰²åç§°ã€‚
          example: user
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - permission_ids
              properties:
                permission_ids:
                  type: array
                  items:
                    type: integer
                  description: æˆæƒç»™è¯¥è§’è‰²çš„æƒé™ ID åˆ—è¡¨ã€‚
                  example: [1, 2, 5, 8]
      responses:
        '200':
          description: è§’è‰²æƒé™æ›´æ–°æˆåŠŸã€‚
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: è§’è‰²ã€Œuserã€æƒé™æ›´æ–°æˆåŠŸ
        '400':
          description: è¯·æ±‚ä½“æ ¼å¼é”™è¯¯ï¼ˆæƒé™IDåˆ—è¡¨éæ•°ç»„ï¼‰ã€‚
        '401':
          description: æœªç™»å½•æˆ– Token æ— æ•ˆã€‚
        '403':
          description: æƒé™ä¸è¶³ (`permission:manage` æƒé™ç¼ºå¤±)ã€‚
        '500':
          description: æ›´æ–°æ“ä½œå¤±è´¥ã€‚

  # --- Phishing Detection Paths ---
  /phishing/predict:
    post:
      tags:
        - Phishing Detection
      summary: é¢„æµ‹é‚®ä»¶å†…å®¹æ˜¯å¦ä¸ºé’“é±¼é‚®ä»¶
      description: |
        æ¥æ”¶é‚®ä»¶å†…å®¹ï¼Œä½¿ç”¨å·²åŠ è½½çš„æœºå™¨å­¦ä¹ æ¨¡å‹è¿›è¡Œé¢„æµ‹ã€‚
        é¢„æµ‹ç»“æœå°†è®°å½•åˆ°æœ¬åœ°æ—¥å¿—æ–‡ä»¶å’Œæ•°æ®åº“è¡¨ `phishing_results` ä¸­ã€‚
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email_content
              properties:
                email_content:
                  type: string
                  description: å¾…æ£€æµ‹çš„é‚®ä»¶å†…å®¹ï¼ˆæ­£æ–‡ï¼‰ã€‚
                  example: Click the link below to verify your account immediately, or it will be suspended.
      responses:
        '200':
          description: æˆåŠŸè¿”å›é¢„æµ‹ç»“æœå’Œæ¦‚ç‡ã€‚
          content:
            application/json:
              schema:
                type: object
                properties:
                  result:
                    type: string
                    enum: [Phishing, Not Phishing]
                    description: é¢„æµ‹çš„åˆ†ç±»ç»“æœã€‚
                    example: Phishing
                  probability:
                    type: number
                    format: float
                    description: é¢„æµ‹ä¸º Phishing çš„æ¦‚ç‡ (0.0 åˆ° 1.0)ã€‚
                    example: 0.9567

  /phishing/metrics:
    get:
      tags:
        - Phishing Detection
      summary: è·å–æ¨¡å‹æ€§èƒ½æŒ‡æ ‡
      description: |
        ä»é™æ€æ–‡ä»¶ `model_metrics.txt` ä¸­è¯»å–å½“å‰æ¨¡å‹çš„å‡†ç¡®ç‡ã€ç²¾ç¡®åº¦ã€å¬å›ç‡å’Œ F1 åˆ†æ•°ã€‚
      responses:
        '200':
          description: æˆåŠŸè¿”å›æ¨¡å‹è¯„ä¼°æŒ‡æ ‡ã€‚
          content:
            application/json:
              schema:
                type: object
                properties:
                  accuracy:
                    type: number
                    format: float
                    example: 0.9850
                  precision:
                    type: number
                    format: float
                    example: 0.9920
                  recall:
                    type: number
                    format: float
                    example: 0.9705
                  f1_score:
                    type: number
                    format: float
                    example: 0.9812
        '400':
          description: æ¨¡å‹æœªè®­ç»ƒæˆ–æŒ‡æ ‡æ–‡ä»¶ä¸å­˜åœ¨ã€‚
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: æ¨¡å‹æœªè®­ç»ƒ

  /phishing/retrain:
    post:
      tags:
        - Phishing Detection
      summary: é‡æ–°è®­ç»ƒå¹¶ä¿å­˜æœºå™¨å­¦ä¹ æ¨¡å‹
      description: |
        ä½¿ç”¨æœ€æ–°çš„æ•°æ®é›†é‡æ–°è®­ç»ƒ Keras æ·±åº¦å­¦ä¹ æ¨¡å‹ï¼Œå¹¶ä¿å­˜æ¨¡å‹æ–‡ä»¶å’Œæ–°çš„æ€§èƒ½æŒ‡æ ‡ã€‚
      responses:
        '200':
          description: é‡æ–°è®­ç»ƒæˆåŠŸï¼Œè¿”å›æ–°æ¨¡å‹çš„æ€§èƒ½æŒ‡æ ‡ã€‚
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  metrics:
                    type: object
                    properties:
                      accuracy:
                        type: number
                        format: float
        '500':
          description: è®­ç»ƒè¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯ã€‚

  # --- Phishing Results Paths ---
  /phishing/history:
    get:
      tags:
        - Phishing Results
      summary: è·å–æœ€è¿‘çš„é¢„æµ‹å†å²è®°å½•
      description: |
        ä»æ•°æ®åº“è¡¨ `phishing_results` ä¸­æŸ¥è¯¢æ‰€æœ‰å†å²é¢„æµ‹è®°å½•ï¼ŒæŒ‰æ—¶é—´å€’åºæ’åˆ—ã€‚
      responses:
        '200':
          description: æˆåŠŸè¿”å›å†å²è®°å½•åˆ—è¡¨ã€‚
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/PredictionHistory'
        '500':
          description: æ•°æ®åº“æŸ¥è¯¢å¤±è´¥ã€‚

  /phishing/clear:
    get:
      tags:
        - Phishing Results
      summary: æ¸…ç†æ‰€æœ‰å†å²é¢„æµ‹ç»“æœ
      description: |
        æ‰§è¡Œ SQL `TRUNCATE TABLE phishing_results`ï¼Œæ¸…ç©ºæ•´ä¸ªå†å²é¢„æµ‹è¡¨ã€‚
      responses:
        '200':
          description: æ¸…ç†æˆåŠŸã€‚
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  message:
                    type: string
                    example: é¢„æµ‹ç»“æœå·²æ¸…ç†
        '500':
          description: æ•°æ®åº“æ“ä½œå¤±è´¥ã€‚

  # --- Email Configuration & Cron Paths ---
  /phishing/cron_email_check:
    post:
      tags:
        - Email Configuration & Cron
      summary: å®šæ—¶æ£€æŸ¥é‚®ç®±æ–°é‚®ä»¶å¹¶è¿›è¡Œé’“é±¼æ£€æµ‹
      description: |
        å®šæ—¶ä»»åŠ¡æ¥å£ã€‚éå†æ•°æ®åº“ `email_configs` ä¸­é…ç½®çš„æ‰€æœ‰é‚®ç®±ï¼Œ
        è·å–è¿‡å» `minutes` å†…çš„æ–°é‚®ä»¶ï¼Œå¯¹é‚®ä»¶å†…å®¹è¿›è¡Œé’“é±¼æ£€æµ‹ï¼Œå¹¶å‘é€å‘Šè­¦ï¼ˆå¦‚æœé…ç½®äº† webhookï¼‰ã€‚
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                minutes:
                  type: integer
                  description: æ£€æŸ¥è¿‡å»å¤šå°‘åˆ†é’Ÿå†…çš„é‚®ä»¶ï¼ˆé»˜è®¤ 3 åˆ†é’Ÿï¼‰ã€‚
                  example: 5
      responses:
        '200':
          description: é‚®ä»¶æ£€æŸ¥å’Œæ£€æµ‹å®Œæˆã€‚
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  checked_email_ids:
                    type: array
                    items:
                      type: string
                    description: æ£€æŸ¥è¿‡çš„é‚®ä»¶ ID åˆ—è¡¨ã€‚
                  phishing_count:
                    type: integer
                    description: æ£€æµ‹åˆ°çš„é’“é±¼é‚®ä»¶æ•°é‡ã€‚
                  total_count:
                    type: integer
                    description: æ£€æŸ¥çš„é‚®ä»¶æ€»æ•°ã€‚
        '500':
          description: è·å–é‚®ç®±é…ç½®æˆ–æ£€æŸ¥è¿‡ç¨‹ä¸­å‡ºé”™ã€‚

  /phishing/email_configs:
    get:
      tags:
        - Email Configuration & Cron
      summary: è·å–æ‰€æœ‰é‚®ç®±é…ç½®åˆ—è¡¨
      description: ä»æ•°æ®åº“ `email_configs` è¡¨ä¸­æŸ¥è¯¢æ‰€æœ‰å·²é…ç½®çš„é‚®ç®±è¿æ¥ä¿¡æ¯ã€‚
      responses:
        '200':
          description: æˆåŠŸè¿”å›é‚®ç®±é…ç½®åˆ—è¡¨ã€‚
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/EmailConfig'
        '500':
          description: æ•°æ®åº“æŸ¥è¯¢å¤±è´¥ã€‚
    post:
      tags:
        - Email Configuration & Cron
      summary: åˆ›å»ºæ–°çš„é‚®ç®±é…ç½®
      description: |
        å‘æ•°æ®åº“ `email_configs` è¡¨ä¸­æ·»åŠ ä¸€ä¸ªæ–°çš„é‚®ç®±è¿æ¥é…ç½®ã€‚
      requestBody:
        required: true
        content:
          application/json:
            schema:
              allOf:
                - $ref: '#/components/schemas/EmailConfigBase'
                - type: object
                  required: [username, passwd, server, port, webhook_url]
      responses:
        '201':
          description: åˆ›å»ºæˆåŠŸï¼Œè¿”å›æ–°é…ç½®çš„ IDã€‚
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/EmailConfigBase'
                  - type: object
                    properties:
                      id:
                        type: integer
                        example: 10
        '400':
          description: ç¼ºå°‘å¿…éœ€å­—æ®µã€‚
        '500':
          description: æ•°æ®åº“æ“ä½œå¤±è´¥ã€‚

  /phishing/email_configs/{config_id}:
    put:
      tags:
        - Email Configuration & Cron
      summary: æ›´æ–°æŒ‡å®šé‚®ç®±é…ç½®
      description: |
        æ›´æ–°æ•°æ®åº“ `email_configs` è¡¨ä¸­æŒ‡å®š ID çš„é‚®ç®±é…ç½®ä¿¡æ¯ã€‚
        **éœ€è¦æƒé™ï¼š`/api/email_configs` çš„ `PUT` åŠ¨ä½œã€‚**
      security:
        - BearerAuth: []
      parameters:
        - name: config_id
          in: path
          required: true
          schema:
            type: integer
          description: è¦æ›´æ–°çš„é…ç½® IDã€‚
      requestBody:
        required: true
        content:
          application/json:
            schema:
              allOf:
                - $ref: '#/components/schemas/EmailConfigBase'
                - type: object
                  required: [username, passwd, server, port, webhook_url]
      responses:
        '200':
          description: æ›´æ–°æˆåŠŸã€‚
        '400':
          description: ç¼ºå°‘å¿…éœ€å­—æ®µã€‚
        '403':
          description: æƒé™ä¸è¶³ã€‚
        '404':
          description: é‚®ç®±é…ç½®ä¸å­˜åœ¨ã€‚
        '500':
          description: æ•°æ®åº“æ“ä½œå¤±è´¥ã€‚
    delete:
      tags:
        - Email Configuration & Cron
      summary: åˆ é™¤æŒ‡å®šé‚®ç®±é…ç½®
      description: ä»æ•°æ®åº“ `email_configs` è¡¨ä¸­åˆ é™¤æŒ‡å®š ID çš„é‚®ç®±é…ç½®ã€‚
      parameters:
        - name: config_id
          in: path
          required: true
          schema:
            type: integer
          description: è¦åˆ é™¤çš„é…ç½® IDã€‚
      responses:
        '200':
          description: åˆ é™¤æˆåŠŸã€‚
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: é‚®ç®±é…ç½®åˆ é™¤æˆåŠŸ
        '404':
          description: é‚®ç®±é…ç½®ä¸å­˜åœ¨ã€‚
        '500':
          description: æ•°æ®åº“æ“ä½œå¤±è´¥ã€‚

  # --- Dataset Management Paths ---
  /phishing/dataset/info:
    get:
      tags:
        - Dataset Management
      summary: è·å–å½“å‰æ•°æ®é›†çš„å…ƒä¿¡æ¯
      description: |
        æ£€æŸ¥æ•°æ®é›†æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œå¹¶è¿”å›æ–‡ä»¶å¤§å°ã€æœ€åä¿®æ”¹æ—¶é—´ã€æ€»è¡Œæ•°ä»¥åŠåƒåœ¾é‚®ä»¶/éåƒåœ¾é‚®ä»¶çš„è®¡æ•°ã€‚
      responses:
        '200':
          description: æˆåŠŸè¿”å›æ•°æ®é›†ä¿¡æ¯ã€‚
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DatasetInfo'
        '500':
          description: è¯»å–æ–‡ä»¶æˆ–è§£ææ•°æ®æ—¶å‘ç”Ÿé”™è¯¯ã€‚

  /phishing/dataset/upload:
    post:
      tags:
        - Dataset Management
      summary: ä¸Šä¼ æ–°çš„æ•°æ®é›†æ–‡ä»¶
      description: |
        ä¸Šä¼ æ–°çš„ `spam_assassin.csv` æ–‡ä»¶æ›¿æ¢ç°æœ‰æ•°æ®é›†ã€‚
        æ–°æ–‡ä»¶å¿…é¡»åŒ…å« `text` å’Œ `target` åˆ—ã€‚ä¸Šä¼ æˆåŠŸåä¼šè‡ªåŠ¨è§¦å‘ `load_resources`ã€‚
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                file:
                  type: string
                  format: binary
                  description: æ–°çš„ CSV æ•°æ®é›†æ–‡ä»¶ã€‚
      responses:
        '200':
          description: æ•°æ®é›†ä¸Šä¼ å¹¶åŠ è½½æˆåŠŸã€‚
        '400':
          description: æœªä¸Šä¼ æ–‡ä»¶ã€æ–‡ä»¶ç±»å‹é”™è¯¯æˆ–æ–‡ä»¶æ ¼å¼ä¸æ­£ç¡®ï¼ˆç¼ºå°‘ text/target åˆ—ï¼‰ã€‚
        '500':
          description: æœåŠ¡å™¨æ–‡ä»¶æ“ä½œå¤±è´¥ã€‚

  # --- Vulnerability Data (CVE) Paths ---
  /cve:
    get:
      tags:
        - Vulnerability Data (CVE)
      summary: æŸ¥è¯¢ CVE æ¼æ´æ•°æ®
      description: |
        ä»æ•°æ®åº“ `cve_data` è¡¨ä¸­æŸ¥è¯¢ CVE æ¼æ´ä¿¡æ¯ã€‚
        æ”¯æŒæ ¹æ® CVE ID ç²¾ç¡®æŸ¥è¯¢ï¼Œæˆ–æŸ¥è¯¢æœ€è¿‘å‘å¸ƒçš„å¤šæ¡è®°å½•ã€‚
        
        **æ³¨æ„ï¼š** æ— è®ºæŸ¥è¯¢å•æ¡è¿˜æ˜¯å¤šæ¡ï¼ŒæˆåŠŸå“åº”ä½“éƒ½æ˜¯ JSON æ•°ç»„ã€‚
      parameters:
        - name: cve_id
          in: query
          required: false
          schema:
            type: string
            example: CVE-2024-0001
          description: æŒ‰ CVE ID æˆ–æ•°æ®åº“ ID ç²¾ç¡®æŸ¥è¯¢å•æ¡è®°å½•ã€‚
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            default: 500
            minimum: 1
          description: å¦‚æœæœªæä¾› `cve_id`ï¼Œåˆ™é™åˆ¶è¿”å›çš„æœ€æ–°è®°å½•æ•°é‡ã€‚
      responses:
        '200':
          description: æˆåŠŸè¿”å› CVE è®°å½•åˆ—è¡¨ï¼ˆå¯èƒ½æ˜¯å•æ¡æˆ–å¤šæ¡ï¼‰ã€‚
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/CveDataRecord'
              examples:
                single_record:
                  summary: æŸ¥è¯¢å•æ¡è®°å½•
                  value:
                    - id: 10
                      cve_id: CVE-2024-0001
                      published: 2024-01-01T10:00:00Z
                      description: A critical vulnerability in component X.
                multiple_records:
                  summary: æŸ¥è¯¢å¤šæ¡è®°å½•
                  value:
                    - id: 15
                      cve_id: CVE-2024-0005
                      published: 2024-01-05T12:00:00Z
                    - id: 14
                      cve_id: CVE-2024-0004
                      published: 2024-01-04T09:00:00Z
        '500':
          description: æ•°æ®åº“æŸ¥è¯¢å¤±è´¥ã€‚
          content:
            application/json:
              schema:
                type: array
                description: é”™è¯¯æ—¶è¿”å›ç©ºæ•°ç»„ï¼Œä»¥ä¿æŒç»Ÿä¸€çš„å“åº”æ ¼å¼ã€‚
              example: []

  # --- Security News Paths ---
  /news:
    get:
      tags:
        - Security News
      summary: è·å–å¹¶åŒæ­¥æœ€æ–°çš„ç½‘ç»œå®‰å…¨æ–°é—»
      description: |
        è¯¥æ¥å£æ˜¯ä¸€ä¸ªå¤åˆæ“ä½œï¼š
        1. **æ•°æ®æŠ“å–:** å®æ—¶ä»é…ç½®çš„æº (CSDN, FreeBuf RSS) æŠ“å–æœ€æ–°çš„æ–°é—»ã€‚
        2. **æ•°æ®åŒæ­¥:** æ¸…ç©ºæ•°æ®åº“è¡¨ `news_data`ï¼Œå¹¶æ’å…¥æœ€æ–°æŠ“å–åˆ°çš„æ•°æ®ã€‚
        3. **æ•°æ®æŸ¥è¯¢:** æ ¹æ®æŸ¥è¯¢å‚æ•°ä»æ•°æ®åº“ä¸­è¿”å›æœ€ç»ˆçš„æ–°é—»åˆ—è¡¨ã€‚
        
        **æ³¨æ„ï¼š** æ¯æ¬¡è°ƒç”¨éƒ½ä¼šé‡æ–°è§¦å‘æŠ“å–å’Œæ•°æ®åº“åŒæ­¥ã€‚
      parameters:
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            default: 30
            minimum: 1
          description: é™åˆ¶è¿”å›çš„æ–°é—»è®°å½•æ•°é‡ã€‚
        - name: source
          in: query
          required: false
          schema:
            type: string
            example: FreeBuf
          description: æŒ‰æ–°é—»æ¥æºç­›é€‰ï¼ˆå¦‚ FreeBuf, CSDNï¼‰ã€‚
        - name: category
          in: query
          required: false
          schema:
            type: string
            example: ç½‘ç»œå®‰å…¨
          description: æŒ‰æ–°é—»ç±»åˆ«ç­›é€‰ã€‚
        - name: keyword
          in: query
          required: false
          schema:
            type: string
            description: æ ‡é¢˜å…³é”®è¯æ¨¡ç³ŠæŸ¥è¯¢ã€‚
      responses:
        '200':
          description: æˆåŠŸè¿”å›æ–°é—»åˆ—è¡¨ã€‚
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/NewsItem'
              examples:
                success_response:
                  value:
                    - id: 1
                      title: "æŸå…¬å¸å› é…ç½®é”™è¯¯å¯¼è‡´æ•°æ®æ³„éœ²"
                      summary: "FreeBuf æŠ¥é“äº†æœ€æ–°çš„å®‰å…¨äº‹ä»¶..."
                      content: null
                      source: "FreeBuf"
                      category: "ç½‘ç»œå®‰å…¨"
                      author: "FreeBuf"
                      url: "http://example.com/1"
                      mobile_url: "http://example.com/1"
                      cover: null
                      hot: 150
                      timestamp: 1732688400
                      published_at: "2025-11-27T10:00:00"
                      time: "1å°æ—¶å‰"
                      created_at: "2025-11-27T11:00:00"
                      updated_at: "2025-11-27T11:00:00"
        '500':
          description: æŠ“å–ã€åŒæ­¥æˆ–æŸ¥è¯¢è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯ã€‚
          content:
            application/json:
              schema:
                type: array
                description: é”™è¯¯æ—¶è¿”å›ç©ºæ•°ç»„ã€‚
              example: []

  /news/stats:
    get:
      tags:
        - Security News
      summary: è·å–æ–°é—»æ•°æ®çš„ç»Ÿè®¡ä¿¡æ¯
      description: |
        ç»Ÿè®¡æ•°æ®åº“ä¸­å·²æœ‰çš„æ–°é—»æ•°æ®ï¼šæ€»æ¡æ•°ã€24å°æ—¶å†…æ–°å¢æ¡æ•°ã€æŒ‰æ¥æºå’Œåˆ†ç±»ç»Ÿè®¡çš„æ¡æ•°ã€‚
      responses:
        '200':
          description: æˆåŠŸè¿”å›ç»Ÿè®¡æ•°æ®ã€‚
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  stats:
                    type: object
                    properties:
                      total:
                        type: integer
                        description: æ•°æ®åº“ä¸­çš„æ–°é—»æ€»æ•°ã€‚
                        example: 58
                      recent_24h:
                        type: integer
                        description: è¿‡å» 24 å°æ—¶å†…åˆ›å»ºçš„æ–°é—»æ•°ã€‚
                        example: 30
                      by_source:
                        type: object
                        description: æŒ‰æ–°é—»æ¥æºç»Ÿè®¡çš„æ•°é‡ã€‚
                        example:
                          FreeBuf: 30
                          CSDN: 28
                      by_category:
                        type: object
                        description: æŒ‰æ–°é—»ç±»åˆ«ç»Ÿè®¡çš„æ•°é‡ã€‚
                        example:
                          ç½‘ç»œå®‰å…¨: 58
        '500':
          description: æ•°æ®åº“æŸ¥è¯¢å¤±è´¥ã€‚

  /news/sync:
    post:
      tags:
        - Security News
      summary: [å·²åºŸå¼ƒ] æ‰‹åŠ¨åŒæ­¥æ–°é—»æ•°æ®
      description: æ­¤æ¥å£å·²åºŸå¼ƒï¼Œå…¶åŠŸèƒ½å·²åˆå¹¶åˆ° `GET /news` æ¥å£ä¸­ã€‚
      responses:
        '410':
          description: æ¥å£å·²åºŸå¼ƒã€‚
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  message:
                    type: string
                    example: æ­¤æ¥å£å·²åºŸå¼ƒï¼Œè¯·ä½¿ç”¨ GET /news æ¥å£æ¥è·å–æœ€æ–°æ•°æ®ã€‚

  # --- Threat Intelligence Paths ---
  /query:
    post:
      tags:
        - Threat Intelligence
      summary: æŸ¥è¯¢ IPã€URL æˆ–æ–‡ä»¶å“ˆå¸Œçš„å¨èƒæƒ…æŠ¥
      description: |
        è¯¥æ¥å£é›†æˆå¤šä¸ªå¨èƒæƒ…æŠ¥å¹³å° (VirusTotal, AlienVault OTX) è¿›è¡ŒæŸ¥è¯¢ã€‚
        
        **æŸ¥è¯¢é€»è¾‘ï¼š**
        1. è‡ªåŠ¨æ£€æµ‹æˆ–ä½¿ç”¨æŒ‡å®šç±»å‹ (`ip`, `url`, `file`)ã€‚
        2. æ£€æŸ¥æ•°æ®åº“ç¼“å­˜ï¼Œå¦‚æœæ•°æ®åœ¨ $7$ å¤©å†…æ›´æ–°ï¼Œåˆ™è¿”å›ç¼“å­˜ç»“æœã€‚
        3. å¦‚æœç¼“å­˜è¿‡æœŸæˆ–ä¸å­˜åœ¨ï¼Œåˆ™è°ƒç”¨å¤–éƒ¨ API å¹³å°è¿›è¡Œå®æ—¶æŸ¥è¯¢ã€‚
        4. å®æ—¶æŸ¥è¯¢ç»“æœå°†æ›´æ–°åˆ°æ•°æ®åº“ä¸­ã€‚
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - query
              properties:
                query:
                  type: string
                  description: å¾…æŸ¥è¯¢çš„ IP åœ°å€ã€URL æˆ–æ–‡ä»¶å“ˆå¸Œï¼ˆMD5/SHA1/SHA256ï¼‰ã€‚
                  example: 1.1.1.1
                type:
                  type: string
                  enum: [ip, url, file]
                  nullable: true
                  description: å¼ºåˆ¶æŒ‡å®šæŸ¥è¯¢ç±»å‹ã€‚å¦‚æœæœªæä¾›ï¼Œç³»ç»Ÿå°†å°è¯•è‡ªåŠ¨æ£€æµ‹ã€‚
            examples:
              query_ip:
                value:
                  query: 104.24.12.10
              query_url:
                value:
                  query: https://malicious.example.com/phish.html
              query_file_hash:
                value:
                  query: 7cf3ac535c5c0d1b4636f8753a479153
                  type: file
      responses:
        '200':
          description: æˆåŠŸè¿”å›æ¥è‡ªæ‰€æœ‰å¹³å°çš„å¨èƒæƒ…æŠ¥ç»“æœï¼ˆåŒ…å«ç¼“å­˜çŠ¶æ€ï¼‰ã€‚
          content:
            application/json:
              schema:
                type: object
                properties:
                  type:
                    type: string
                    description: å®é™…ä½¿ç”¨çš„æŸ¥è¯¢ç±»å‹ã€‚
                    example: ip
                  value:
                    type: string
                    description: å®é™…æŸ¥è¯¢çš„å€¼ã€‚
                    example: 104.24.12.10
                  status:
                    type: string
                    example: success
                  results:
                    type: object
                    properties:
                      VirusTotal:
                        $ref: '#/components/schemas/ThreatIntelResult'
                      AlienVault OTX:
                        $ref: '#/components/schemas/ThreatIntelResult'
              example:
                type: ip
                value: 104.24.12.10
                status: success
                results:
                  VirusTotal:
                    id: 10
                    source: VirusTotal
                    target_ip: 104.24.12.10
                    data: '{... VT åŸå§‹æ•°æ® ...}'
                    last_update: "2025-11-20T10:00:00"
                    from_cache: true
                  AlienVault OTX:
                    id: 11
                    source: AlienVault OTX
                    target_ip: 104.24.12.10
                    data: '{... OTX åŸå§‹æ•°æ® ...}'
                    last_update: "2025-11-26T15:30:00"
                    from_cache: false
        '400':
          description: è¯·æ±‚å‚æ•°é”™è¯¯ï¼Œå¦‚æŸ¥è¯¢å†…å®¹ä¸ºç©ºæˆ–ç±»å‹ä¸æ”¯æŒã€‚
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: æŸ¥è¯¢å†…å®¹ä¸èƒ½ä¸ºç©º
        '500':
          description: æœåŠ¡å™¨å†…éƒ¨é”™è¯¯æˆ–å¹³å° API è°ƒç”¨å¤±è´¥ã€‚

  # --- Network Tools Paths ---
  /ip_query:
    get:
      tags:
        - Network Tools
      summary: æŸ¥è¯¢ IP åœ°å€å½’å±åœ°ä¿¡æ¯
      description: |
        ä½¿ç”¨ `ip-api.com` çš„å…è´¹ API æŸ¥è¯¢æŒ‡å®š IP åœ°å€çš„åœ°ç†å½’å±åœ°å’ŒæœåŠ¡æä¾›å•† (ISP) ä¿¡æ¯ã€‚
      parameters:
        - name: ip
          in: query
          required: true
          schema:
            type: string
            format: ipv4
            example: 8.8.8.8
          description: è¦æŸ¥è¯¢çš„ IP åœ°å€ã€‚
      responses:
        '200':
          description: æˆåŠŸè¿”å› IP å½’å±åœ°ä¿¡æ¯ã€‚
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  ip:
                    type: string
                    example: 8.8.8.8
                  country:
                    type: string
                    description: å›½å®¶åç§°ï¼ˆä¸­æ–‡ï¼‰ã€‚
                    example: ç¾å›½
                  city:
                    type: string
                    description: åŸå¸‚åç§°ï¼ˆä¸­æ–‡ï¼‰ã€‚
                    example: å¼—å‰å°¼äºšå·é˜¿ä»€æœ¬
                  isp:
                    type: string
                    description: äº’è”ç½‘æœåŠ¡æä¾›å•†ã€‚
                    example: Google LLC
        '400':
          description: IP åœ°å€å‚æ•°ç¼ºå¤±æˆ–æ— æ•ˆã€‚
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  message:
                    type: string
                    example: IPåœ°å€æ˜¯å¿…é¡»çš„å‚æ•°ï¼Œè¯·åœ¨URLä¸­ä»¥'?ip=...'å½¢å¼æä¾›ã€‚
        '500':
          description: å¤–éƒ¨ API è¯·æ±‚å¤±è´¥æˆ–å†…éƒ¨å¤„ç†é”™è¯¯ã€‚

  /whois_query:
    get:
      tags:
        - Network Tools
      summary: æŸ¥è¯¢åŸŸå Whois ä¿¡æ¯
      description: |
        æŸ¥è¯¢æŒ‡å®šåŸŸåçš„æ³¨å†Œä¿¡æ¯ï¼ŒåŒ…æ‹¬æ³¨å†Œå•†ã€åˆ›å»ºæ—¥æœŸã€è¿‡æœŸæ—¥æœŸç­‰ã€‚
      parameters:
        - name: domain
          in: query
          required: true
          schema:
            type: string
            example: example.com
          description: è¦æŸ¥è¯¢çš„åŸŸåã€‚
      responses:
        '200':
          description: æˆåŠŸè¿”å› Whois ä¿¡æ¯ã€‚
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  domain_name:
                    type: string
                    example: EXAMPLE.COM
                  registrar:
                    type: string
                    example: MARKMONITOR INC.
                  creation_date:
                    type: string
                    format: date-time
                    example: 1995-08-14 04:00:00
                  expiration_date:
                    type: string
                    format: date-time
                    example: 2026-08-13 04:00:00
                  updated_date:
                    type: string
                    format: date-time
                    example: 2024-08-13 04:00:00
                  name_servers:
                    type: array
                    items:
                      type: string
                    example: [A.IANA-SERVERS.NET, B.IANA-SERVERS.NET]
                  status:
                    type: array
                    items:
                      type: string
                    example: [client delete prohibited, client transfer prohibited]
        '400':
          description: åŸŸåå‚æ•°ç¼ºå¤±ã€‚
        '404':
          description: æœªæ‰¾åˆ° Whois ä¿¡æ¯æˆ–åŸŸåæ— æ•ˆã€‚
        '500':
          description: æŸ¥è¯¢è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯ï¼ˆå¦‚ Whois åº“å¼‚å¸¸ï¼‰ã€‚

  # --- WeChat Publisher Paths ---
  /wxgzh:
    post:
      tags:
        - WeChat Publisher
      summary: èšåˆ CVE/æ–°é—»å¹¶å‘å¸ƒå¾®ä¿¡å…¬ä¼—å·æ–‡ç« 
      description: |
        è¿™æ˜¯ä¸€ä¸ªè‡ªåŠ¨åŒ–å†…å®¹èšåˆä¸å‘å¸ƒæ¥å£ï¼Œå®ƒæ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼š
        
        1. **è·å– Access Token:** ä½¿ç”¨é…ç½®çš„ç¯å¢ƒå˜é‡ (wx_appid, wx_secret) è·å–å¾®ä¿¡ Access Tokenã€‚
        2. **æ•°æ®èšåˆ:** - ä»æ•°æ®åº“ `cve_data` æŸ¥è¯¢æœ€æ–°çš„ 30 æ¡ CVE æ¼æ´ä¿¡æ¯ã€‚
           - å®æ—¶æŠ“å– CSDN çƒ­æ¦œå’Œ GitHub Trendingï¼ˆæœ€å¤š 6 ä¸ªé¡¹ç›®ï¼‰ä½œä¸ºæŠ€æœ¯æ–°é—»ã€‚
        3. **å†…å®¹æ¸²æŸ“:** å°† CVEï¼ˆé™åˆ¶å‰ 10 æ¡ï¼‰å’Œæ–°é—»ï¼ˆé™åˆ¶å‰ 10 æ¡ï¼‰æ¸²æŸ“æˆç¬¦åˆå¾®ä¿¡å…¬ä¼—å·è§„èŒƒçš„ HTML æ­£æ–‡ã€‚
        4. **ä¸Šä¼ è‰ç¨¿:** è°ƒç”¨å¾®ä¿¡ API (draft/add) å°†æ¸²æŸ“åçš„ HTML ä¸Šä¼ è‡³è‰ç¨¿ç®±ã€‚
        5. **æäº¤å‘å¸ƒ:** è°ƒç”¨å¾®ä¿¡ API (freepublish/submit) æäº¤è‰ç¨¿ç®±ä¸­çš„æœ€æ–°æ–‡ç« è¿›è¡Œå‘å¸ƒï¼ˆå¯èƒ½éœ€è¦äººå·¥å®¡æ ¸ï¼‰ã€‚
        
        **æ³¨æ„ï¼š** æ­¤æ¥å£æ˜¯å…¨è‡ªåŠ¨æ‰§è¡Œï¼Œä¸æ¥å—è¾“å…¥å‚æ•°ï¼Œç›´æ¥è§¦å‘å†…å®¹ç”Ÿæˆã€ä¸Šä¼ å’Œå‘å¸ƒæµç¨‹ã€‚
      responses:
        '200':
          description: æˆåŠŸæäº¤å‘å¸ƒè¯·æ±‚ã€‚è¿”å›å¾®ä¿¡ freepublish/submit æ¥å£çš„åŸå§‹å“åº”ã€‚
          content:
            application/json:
              schema:
                type: object
                properties:
                  errcode:
                    type: integer
                    description: å¾®ä¿¡ API é”™è¯¯ç  (0 è¡¨ç¤ºæˆåŠŸ)ã€‚
                    example: 0
                  errmsg:
                    type: string
                    description: å¾®ä¿¡ API é”™è¯¯ä¿¡æ¯ã€‚
                    example: ok
                  publish_id:
                    type: string
                    description: å¾®ä¿¡å‘å¸ƒçš„ä»»åŠ¡ IDã€‚
                    example: 123456789
        '400':
          description: å¾®ä¿¡å‘å¸ƒå¤±è´¥ï¼ˆä¾‹å¦‚è‰ç¨¿åˆ—è¡¨ä¸ºç©ºï¼Œæ— æ³•è·å– media_idï¼‰ã€‚
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: ç¼ºå°‘ media_id
        '500':
          description: è·å– Access Token å¤±è´¥ã€æ•°æ®åº“æŸ¥è¯¢å¤±è´¥æˆ–å¾®ä¿¡ API è°ƒç”¨å¤±è´¥ã€‚
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: è·å– access_token å¤±è´¥

components:
  schemas:
    # --- AI Chat Schemas ---
    ModelConfig:
      type: object
      properties:
        id:
          type: integer
          description: æ¨¡å‹é…ç½®çš„å”¯ä¸€ IDã€‚
        name:
          type: string
          description: æ¨¡å‹é…ç½®çš„åç§°ã€‚
        model_identifier:
          type: string
          description: AI å¹³å°çš„æ¨¡å‹æ ‡è¯†ç¬¦ã€‚
        api_endpoint:
          type: string
          format: url
          description: æ¨¡å‹çš„ API è¯·æ±‚åœ°å€ã€‚
        is_active:
          type: boolean
          description: æ¨¡å‹æ˜¯å¦è¢«å¯ç”¨ã€‚
        config:
          type: object
          description: æ¨¡å‹çš„é¢å¤–é…ç½®ä¿¡æ¯ã€‚
      example:
        id: 1
        name: doubao
        model_identifier: skylark-pro-public
        api_endpoint: https://api.example.com/v1/chat/completions
        is_active: true
        config:
          organization: SecurityTeam
    AIErrorResponse:
      type: object
      properties:
        error:
          type: string
          description: é”™è¯¯è¯¦æƒ…ä¿¡æ¯ã€‚
          example: ç¼ºå°‘æ¶ˆæ¯å‚æ•°

    # --- WAF Schemas ---
    WafWhitelistRule:
      type: object
      required:
        - name
        - tags
        - status
        - origin
        - conditions
      properties:
        name:
          type: string
          description: ç™½åå•è§„åˆ™åç§°ã€‚
          example: 'æ”¾è¡Œè¿ç»´IP'
        tags:
          type: string
          description: è§„åˆ™æ ‡ç­¾ï¼ˆWAF API è¦æ±‚ JSON å­—ç¬¦ä¸²æ ¼å¼ï¼‰ã€‚
          example: '{"tag_key":"è¿ç»´", "tag_value":"IP"}'
        status:
          type: integer
          description: è§„åˆ™çŠ¶æ€ (1: å¼€å¯, 0: å…³é—­)ã€‚
          example: 1
        origin:
          type: string
          description: è§„åˆ™æ¥æºã€‚é€šå¸¸ä¸º 'custom'ã€‚
          example: custom
        conditions:
          type: array
          minItems: 1
          description: è§„åˆ™åŒ¹é…æ¡ä»¶åˆ—è¡¨ã€‚
          items:
            $ref: '#/components/schemas/WafRuleCondition'
    WafRuleCondition:
      type: object
      required:
        - field
        - action
        - values
      properties:
        field:
          type: string
          description: åŒ¹é…å­—æ®µ (å¦‚ 'ip', 'url', 'header')ã€‚
          example: ip
        action:
          type: string
          description: åŒ¹é…æ“ä½œ (å¦‚ 'equal', 'contain')ã€‚
          example: equal
        values:
          type: string
          description: åŒ¹é…å€¼ã€‚å¿…é¡»æ˜¯æœ‰æ•ˆçš„ IP/CIDRã€åŸŸåæˆ– URL è·¯å¾„ã€‚
          example: 203.0.113.1/32
    WafErrorResponse:
      type: object
      properties:
        status:
          type: string
          example: error
        message:
          type: string
          description: é”™è¯¯è¯¦æƒ…ä¿¡æ¯ã€‚
          example: ç¼ºå°‘å¿…å¡«å­—æ®µ: name
    WafRuleSummary:
      type: object
      properties:
        rule_template:
          type: integer
          description: è§„åˆ™æ‰€å±çš„æ¨¡æ¿ ID (WHITELIST_TEMPLATE_ID)ã€‚
          example: 123456
        rule_id:
          type: integer
          description: ç™½åå•è§„åˆ™çš„å”¯ä¸€ IDã€‚
          example: 1001
        rule_name:
          type: string
          description: è§„åˆ™çš„åç§°ã€‚
          example: Maintenance IP Whitelist
    BlacklistRuleDetail:
      type: object
      properties:
        template_id:
          type: integer
          description: è§„åˆ™æ‰€å±çš„æ¨¡æ¿ IDã€‚
          example: 12345
        rule_id:
          type: integer
          description: æŸ¥è¯¢çš„è§„åˆ™ IDã€‚
          example: 987654
        rule_name:
          type: string
          description: è§„åˆ™çš„åç§°ã€‚
          example: TestBlacklistRule
        ip_list:
          type: array
          description: ä»è§„åˆ™é…ç½®ä¸­æå–å‡ºçš„é»‘åå• IP/CIDR åˆ—è¡¨ã€‚
          items:
            type: string
            example: 203.0.113.1

    # --- WAF Logs/Data Schemas ---
    BlockedIpData:
      type: object
      properties:
        ip:
          type: string
          description: è¢«å°ç¦çš„ IP åœ°å€ã€‚
          example: 103.25.100.1
        attack_count:
          type: integer
          description: æ”»å‡»æˆ–æ‹¦æˆªçš„æ¬¡æ•°ã€‚
          example: 567
        attack_type:
          type: string
          nullable: true
          description: æ”»å‡»ç±»å‹ï¼ˆå¦‚ SQLi, CC, XSSï¼‰ã€‚
          example: CC
        attack_ratio:
          type: string
          nullable: true
          description: æ”»å‡»å æ€»è¯·æ±‚çš„æ¯”ä¾‹ã€‚
          example: 85.5%
        blocked_time:
          type: string
          format: date-time
          description: å°ç¦èµ·å§‹æ—¶é—´ã€‚
        to_time:
          type: string
          format: date-time
          description: å°ç¦ç»“æŸæ—¶é—´æˆ–æŸ¥è¯¢ç»“æŸæ—¶é—´ã€‚
        threat_score:
          type: integer
          description: å¨èƒè¯„åˆ†ï¼ˆä¸ attack_count ç›¸åŒï¼‰ã€‚
          example: 567
        created_at:
          type: string
          format: date-time
          description: æ•°æ®åº“è®°å½•åˆ›å»ºæ—¶é—´ã€‚
    RequestFrequencyData:
      type: object
      properties:
        ip:
          type: string
          description: è¯·æ±‚é¢‘ç‡é«˜çš„ IP åœ°å€ã€‚
          example: 192.168.1.10
        request_count:
          type: integer
          description: æ—¶é—´èŒƒå›´å†…çš„è¯·æ±‚æ€»æ•°ã€‚
          example: 4500
        last_request_time:
          type: string
          format: date-time
          description: è¯·æ±‚èµ·å§‹æ—¶é—´ã€‚
        to_time:
          type: string
          format: date-time
          description: æŸ¥è¯¢ç»“æŸæ—¶é—´ã€‚
        request_rate:
          type: number
          format: float
          description: æ¯ç§’è¯·æ±‚é€Ÿç‡ (è¯·æ±‚æ•° / æ—¶é—´å·®ç§’æ•°)ã€‚
          example: 1.5
        created_at:
          type: string
          format: date-time
          description: æ•°æ®åº“è®°å½•åˆ›å»ºæ—¶é—´ã€‚
    ProtectedIpRecord:
      type: object
      properties:
        id:
          type: integer
          description: è®°å½• IDã€‚
        ip:
          type: string
          description: è¢«æ‰§è¡ŒåŠ¨ä½œçš„ IP åœ°å€ã€‚
          example: 45.32.12.11
        action:
          type: string
          description: æ‰§è¡Œçš„åŠ¨ä½œ (å¦‚ 'block', 'unblock')ã€‚
          example: block
        reason:
          type: string
          description: è§¦å‘åŠ¨ä½œçš„åŸå› ã€‚
          example: HighReputationScore
        reputation_score:
          type: integer
          description: è§¦å‘åŠ¨ä½œæ—¶çš„ä¿¡èª‰åˆ†ã€‚
          example: 95
        action_time:
          type: string
          format: date-time
          description: åŠ¨ä½œå‘ç”Ÿçš„æ—¶é—´ (ISO 8601 æ ¼å¼)ã€‚
    InternalErrorResponse:
      type: object
      properties:
        error:
          type: string
          description: é”™è¯¯è¯¦æƒ…ä¿¡æ¯ã€‚
          example: æ•°æ®åº“è¿æ¥å¤±è´¥: [Errno 111] Connection refused

    # --- User Schemas ---
    UserDetail:
      type: object
      properties:
        id:
          type: integer
          description: ç”¨æˆ· IDã€‚
          example: 5
        username:
          type: string
          description: ç”¨æˆ·åã€‚
          example: admin
        role:
          type: string
          description: ç”¨æˆ·çš„è§’è‰²ã€‚
          example: admin
        created_at:
          type: string
          format: date-time
          description: ç”¨æˆ·åˆ›å»ºæ—¶é—´ã€‚
          example: 2024-05-15T10:30:00
    UserErrorResponse:
      type: object
      properties:
        success:
          type: boolean
          example: false
        message:
          type: string
          description: é”™è¯¯è¯¦æƒ…ä¿¡æ¯ã€‚
          example: æŸ¥è¯¢ç”¨æˆ·å¤±è´¥ï¼š(1049, "Unknown database 'waf_db'")

    # --- Authentication Schemas ---
    LoginRequest:
      type: object
      required:
        - username
        - password
      properties:
        username:
          type: string
          description: ç™»å½•ç”¨æˆ·åã€‚
          example: admin
        password:
          type: string
          description: ç™»å½•å¯†ç ã€‚
          format: password
          example: P@ssword123
    AuthErrorResponse:
      type: object
      properties:
        status:
          type: string
          example: error
        message:
          type: string
          description: å…·ä½“çš„é”™è¯¯ä¿¡æ¯ã€‚
          example: ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯
          
    # --- Permission Schemas ---
    Permission:
      type: object
      properties:
        id:
          type: integer
          description: æƒé™çš„å”¯ä¸€IDã€‚
          example: 1
        permission_key:
          type: string
          description: æƒé™æ ‡è¯†ç¬¦ (å¦‚ user:list)ã€‚
          example: user:list
        permission_name:
          type: string
          description: æƒé™çš„æ˜¾ç¤ºåç§°ã€‚
          example: æŸ¥è¯¢ç”¨æˆ·åˆ—è¡¨
        permission_group:
          type: string
          description: æƒé™æ‰€å±çš„æ¨¡å—åˆ†ç»„ã€‚
          example: ç”¨æˆ·ç®¡ç†
    PermissionErrorResponse:
      type: object
      properties:
        success:
          type: boolean
          example: false
        message:
          type: string
          description: é”™è¯¯è¯¦æƒ…ä¿¡æ¯ã€‚
          example: æŸ¥è¯¢æ‰€æœ‰æƒé™å¤±è´¥ï¼šæ•°æ®åº“è¿æ¥ä¸­æ–­

    # --- Phishing Schemas ---
    PredictionHistory:
      type: object
      properties:
        id:
          type: integer
          example: 5
        timestamp:
          type: string
          format: date-time
          example: 2025-11-26 15:30:00
        result:
          type: string
          example: Phishing
        probability:
          type: number
          format: float
          example: 0.981
        email_content:
          type: string
          description: é¢„æµ‹æ—¶çš„é‚®ä»¶å†…å®¹ã€‚
          example: The email content predicted...
          
    EmailConfig:
      type: object
      properties:
        id:
          type: integer
          example: 1
          description: é…ç½®çš„å”¯ä¸€ IDã€‚
        username:
          type: string
          example: user@example.com
          description: é‚®ç®±ç”¨æˆ·åã€‚
        passwd:
          type: string
          example: StrongAppPassword
          description: é‚®ç®±å¯†ç æˆ–æˆæƒç ã€‚
        server:
          type: string
          example: imap.example.com
          description: IMAP æœåŠ¡å™¨åœ°å€ã€‚
        port:
          type: integer
          example: 993
          description: IMAP ç«¯å£ã€‚
        webhook_url:
          type: string
          format: url
          example: https://alerts.example.com/hook
          description: ç”¨äºå‘é€å‘Šè­¦çš„ Webhook URLã€‚
    
    EmailConfigBase:
      type: object
      properties:
        username:
          type: string
          example: user@example.com
        passwd:
          type: string
          example: StrongAppPassword
        server:
          type: string
          example: imap.example.com
        port:
          type: integer
          example: 993
        webhook_url:
          type: string
          format: url
          example: https://alerts.example.com/hook

    DatasetInfo:
      type: object
      properties:
        exists:
          type: boolean
          example: true
          description: æ•°æ®é›†æ–‡ä»¶æ˜¯å¦å­˜åœ¨ã€‚
        filename:
          type: string
          example: spam_assassin.csv
        filepath:
          type: string
        file_size:
          type: integer
          example: 1548000
          description: æ–‡ä»¶å¤§å°ï¼ˆå­—èŠ‚ï¼‰ã€‚
        last_modified:
          type: string
          format: date-time
          example: 2025-11-26 15:30:00
        total_rows:
          type: integer
          example: 4601
          description: æ•°æ®é›†æ€»è¡Œæ•°ã€‚
        spam_count:
          type: integer
          example: 1813
          description: æ ‡è®°ä¸ºåƒåœ¾é‚®ä»¶ï¼ˆtarget=1ï¼‰çš„è¡Œæ•°ã€‚
        ham_count:
          type: integer
          example: 2788
          description: æ ‡è®°ä¸ºéåƒåœ¾é‚®ä»¶ï¼ˆtarget=0ï¼‰çš„è¡Œæ•°ã€‚
        columns:
          type: array
          items:
            type: string
          example: [text, target, tokens]

    # --- CVE Schemas ---
    CveDataRecord:
      type: object
      description: CVE æ¼æ´æ•°æ®åº“ä¸­çš„ä¸€æ¡è®°å½•ï¼ˆå­—æ®µå¯èƒ½å› æ•°æ®åº“å®šä¹‰è€Œå¼‚ï¼‰ã€‚
      properties:
        id:
          type: integer
          description: æ•°æ®åº“å†…éƒ¨ IDã€‚
          example: 10
        cve_id:
          type: string
          description: æ¼æ´çš„å®˜æ–¹ CVE IDã€‚
          example: CVE-2024-0001
        published:
          type: string
          format: date-time
          description: æ¼æ´çš„å‘å¸ƒæ—¶é—´ã€‚
          example: 2024-01-01T10:00:00Z
        description:
          type: string
          description: æ¼æ´çš„ç®€çŸ­æè¿°ã€‚
          example: A critical vulnerability affecting product X.
        cvss_score:
          type: number
          format: float
          nullable: true
          example: 9.8
        vulnerability_status:
          type: string
          nullable: true
          example: Analyzed

    # --- News Schemas ---
    NewsItem:
      type: object
      description: å•æ¡æ–°é—»è®°å½•çš„è¯¦ç»†ä¿¡æ¯ã€‚
      properties:
        id:
          type: integer
          description: æ•°æ®åº“ IDã€‚
          example: 1
        title:
          type: string
          description: æ–°é—»æ ‡é¢˜ã€‚
          example: æŸå…¬å¸å› é…ç½®é”™è¯¯å¯¼è‡´æ•°æ®æ³„éœ²
        summary:
          type: string
          nullable: true
          description: æ–°é—»æ‘˜è¦æˆ–ç®€è¦æè¿°ã€‚
          example: FreeBuf æŠ¥é“äº†æœ€æ–°çš„å®‰å…¨äº‹ä»¶...
        content:
          type: string
          nullable: true
          description: æ–°é—»å†…å®¹ï¼ˆå¯èƒ½ä¸ºç©ºï¼‰ã€‚
        source:
          type: string
          description: æ–°é—»æ¥æºï¼ˆå¦‚ FreeBuf, CSDNï¼‰ã€‚
          example: FreeBuf
        category:
          type: string
          description: æ–°é—»åˆ†ç±»ã€‚
          example: ç½‘ç»œå®‰å…¨
        author:
          type: string
          nullable: true
          description: æ–‡ç« ä½œè€…ã€‚
          example: FreeBuf
        url:
          type: string
          format: url
          description: åŸå§‹æ–‡ç« é“¾æ¥ã€‚
          example: http://example.com/article
        mobile_url:
          type: string
          format: url
          description: ç§»åŠ¨ç«¯æ–‡ç« é“¾æ¥ï¼ˆå¯èƒ½ä¸ url ç›¸åŒï¼‰ã€‚
        cover:
          type: string
          format: url
          nullable: true
          description: å°é¢å›¾ç‰‡ URLã€‚
        hot:
          type: integer
          description: çƒ­åº¦è¯„åˆ†ã€‚
          example: 150
        timestamp:
          type: integer
          description: æ–‡ç« å‘å¸ƒæ—¶é—´æˆ³ï¼ˆUnix Timeï¼‰ã€‚
          example: 1732688400
        published_at:
          type: string
          format: date-time
          description: æ–‡ç« å‘å¸ƒæ—¶é—´ï¼ˆISO 8601 æ ¼å¼ï¼‰ã€‚
          example: 2025-11-27T10:00:00
        time:
          type: string
          description: ç›¸å¯¹æ—¶é—´æè¿°ï¼ˆå¦‚ '1å°æ—¶å‰'ï¼‰ã€‚
          example: 1å°æ—¶å‰
        created_at:
          type: string
          format: date-time
          description: è®°å½•åˆ›å»ºæ—¶é—´ï¼ˆISO 8601 æ ¼å¼ï¼‰ã€‚
        updated_at:
          type: string
          format: date-time
          description: è®°å½•æ›´æ–°æ—¶é—´ï¼ˆISO 8601 æ ¼å¼ï¼‰ã€‚

    # --- Threat Intel Schemas ---
    ThreatIntelResult:
      type: object
      description: å•ä¸ªå¨èƒæƒ…æŠ¥å¹³å°çš„æŸ¥è¯¢ç»“æœã€‚
      properties:
        id:
          type: integer
          nullable: true
          description: æ•°æ®åº“å†…éƒ¨ IDã€‚
        source:
          type: string
          example: VirusTotal
        target_ip:
          type: string
          nullable: true
          description: ç›®æ ‡ IP åœ°å€ï¼ˆå¦‚æœæŸ¥è¯¢ç±»å‹æ˜¯ IPï¼‰ã€‚
        target_url:
          type: string
          nullable: true
          description: ç›®æ ‡ URL åœ°å€ï¼ˆå¦‚æœæŸ¥è¯¢ç±»å‹æ˜¯ URLï¼‰ã€‚
        target_hash:
          type: string
          nullable: true
          description: ç›®æ ‡æ–‡ä»¶å“ˆå¸Œï¼ˆå¦‚æœæŸ¥è¯¢ç±»å‹æ˜¯ Fileï¼‰ã€‚
        data:
          type: string
          description: å¨èƒæƒ…æŠ¥å¹³å°çš„åŸå§‹ JSON å“åº”æ•°æ®ï¼ˆå·²åºåˆ—åŒ–ä¸ºå­—ç¬¦ä¸²ï¼‰ã€‚
        last_update:
          type: string
          format: date-time
          description: æ•°æ®æœ€åä¸€æ¬¡æ›´æ–°æ—¶é—´ã€‚
        from_cache:
          type: boolean
          nullable: true
          description: æŒ‡ç¤ºæ•°æ®æ˜¯å¦æ¥è‡ªæ•°æ®åº“ç¼“å­˜ã€‚
        error:
          type: string
          nullable: true
          description: å¦‚æœæŸ¥è¯¢å¤±è´¥ï¼Œåˆ™åŒ…å«é”™è¯¯ä¿¡æ¯ã€‚
          example: APIé™é€Ÿï¼Œè¯·ç¨åé‡è¯•ã€‚

  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: ç”¨äºè®¤è¯çš„ JWT Tokenã€‚
    CookieAuth:
      type: apiKey
      in: cookie
      name: session
      description: é€šè¿‡ Flask Session Cookie è¿›è¡Œèº«ä»½éªŒè¯ã€‚